import{R as f,r as d,s as m,j as n,i as P,c as C}from"./index-sMwwGbn-.js";var N={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},v=f.createContext&&f.createContext(N),_=["attr","size","title"];function E(e,r){if(e==null)return{};var t=S(e,r),s,i;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)s=a[i],!(r.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(e,s)&&(t[s]=e[s])}return t}function S(e,r){if(e==null)return{};var t={};for(var s in e)if(Object.prototype.hasOwnProperty.call(e,s)){if(r.indexOf(s)>=0)continue;t[s]=e[s]}return t}function g(){return g=Object.assign?Object.assign.bind():function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},g.apply(this,arguments)}function y(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);r&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,s)}return t}function p(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?y(Object(t),!0).forEach(function(s){k(e,s,t[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):y(Object(t)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(t,s))})}return e}function k(e,r,t){return r=L(r),r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function L(e){var r=I(e,"string");return typeof r=="symbol"?r:r+""}function I(e,r){if(typeof e!="object"||!e)return e;var t=e[Symbol.toPrimitive];if(t!==void 0){var s=t.call(e,r);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(e)}function w(e){return e&&e.map((r,t)=>f.createElement(r.tag,p({key:t},r.attr),w(r.child)))}function b(e){return r=>f.createElement(F,g({attr:p({},e.attr)},r),w(e.child))}function F(e){var r=t=>{var{attr:s,size:i,title:a}=e,o=E(e,_),u=i||t.size||"1em",c;return t.className&&(c=t.className),e.className&&(c=(c?c+" ":"")+e.className),f.createElement("svg",g({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,s,o,{className:c,style:p(p({color:e.color||t.color},t.style),e.style),height:u,width:u,xmlns:"http://www.w3.org/2000/svg"}),a&&f.createElement("title",null,a),e.children)};return v!==void 0?f.createElement(v.Consumer,null,t=>r(t)):r(N)}function W(e){return b({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"1"},child:[]},{tag:"circle",attr:{cx:"12",cy:"5",r:"1"},child:[]},{tag:"circle",attr:{cx:"12",cy:"19",r:"1"},child:[]}]})(e)}function z(e){return b({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"},child:[]}]})(e)}function D(e){return b({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"11",cy:"11",r:"8"},child:[]},{tag:"line",attr:{x1:"21",y1:"21",x2:"16.65",y2:"16.65"},child:[]}]})(e)}function M(e){return b({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"23 7 16 12 23 17 23 7"},child:[]},{tag:"rect",attr:{x:"1",y:"5",width:"15",height:"14",rx:"2",ry:"2"},child:[]}]})(e)}function R({chatId:e,friendName:r,userId:t,friendImage:s}){const[i,a]=d.useState([]),[o,u]=d.useState(""),c=d.useRef(null);d.useEffect(()=>{m.emit("join_chat",e);const l=h=>a(h),x=h=>{h.chatId===e&&a(O=>[...O,h]),console.log(h)};return m.on("all_messages",l),m.on("receive_message",x),()=>{m.off("all_messages",l),m.off("receive_message",x)}},[e]),d.useEffect(()=>{a([])},[e]),d.useEffect(()=>{c.current?.scrollIntoView({behavior:"smooth"})},[i]);const j=l=>{if(l.preventDefault(),!o.trim())return console.warn("write something");const x={chatId:e,senderId:t,text:o};m.emit("send_message",x),u("")};return n.jsxs("section",{className:"flex-1 flex flex-col",children:[n.jsxs("header",{className:"flex items-center justify-between py-2 px-4 border-b border-gray-800 bg-[#161b22]",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("img",{src:s,alt:"profile",className:"w-10 h-10 rounded-full"}),n.jsxs("div",{children:[n.jsx("p",{className:"font-medium text-sm",children:r}),n.jsx("span",{className:"text-xs text-green-400",children:"Online"})]})]}),n.jsxs("div",{className:"flex gap-4 text-gray-400",children:[n.jsx(z,{className:"cursor-pointer hover:text-white"}),n.jsx(M,{className:"cursor-pointer hover:text-white"}),n.jsx(W,{className:"cursor-pointer hover:text-white"})]})]}),n.jsx("div",{className:"flex flex-col h-[77.2vh] bg-[#0d1117]",children:n.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-4",children:[i.map((l,x)=>n.jsxs("article",{className:`flex flex-col ${l.senderId===t?"items-end":"items-start"}`,children:[n.jsx("p",{className:`px-4 py-2 rounded-lg text-sm ${l.senderId===t?"bg-blue-600":"bg-[#161b22]"}`,children:l.text}),n.jsx("time",{className:"text-xs text-gray-400 mt-1",children:l?.time})]},x)),n.jsx("div",{ref:c})]})}),n.jsx("footer",{className:"p-4 border-t border-gray-800 bg-[#161b22]",children:n.jsxs("form",{onSubmit:j,className:"flex items-center gap-3",children:[n.jsx("input",{type:"text",placeholder:"Type a message...",className:"flex-1 rounded-full bg-[#0d1117] px-4 py-2 text-sm focus:outline-none focus:ring-1 focus:ring-blue-500",value:o,onChange:l=>u(l.target.value),onKeyDown:l=>l.key==="Enter"&&j(l)}),n.jsx("button",{type:"submit",className:"bg-blue-600 rounded-full hover:bg-blue-700 transition",children:n.jsx("img",{src:"./src/assets/send.svg",className:"size-12 pl-1",alt:""})})]})})]})}const B=({friends:e,userId:r})=>{const[t,s]=d.useState(null);console.log(t);const i=async(a,o,u)=>{const c=await P.post("/api/chat",{friendId:a,userId:r});s({chatId:c.data._id,friendId:a,friendName:o,friendImage:u})};return n.jsxs("div",{className:"flex w-full",children:[n.jsxs("aside",{className:" md:flex w-72 flex-col border-r border-gray-800 bg-[#161b22]",children:[n.jsx("header",{className:"p-4 font-semibold text-lg border-b border-gray-800",children:"Chats"}),n.jsx("div",{className:"p-3",children:n.jsxs("div",{className:"flex items-center bg-[#0d1117] rounded-md px-3",children:[n.jsx(D,{className:"text-gray-400 mr-2"}),n.jsx("input",{type:"text",placeholder:"Search",className:"w-full bg-transparent py-2 text-sm focus:outline-none"})]})}),n.jsx("nav",{className:"flex-1 overflow-y-auto",children:n.jsx("ul",{children:e.map((a,o)=>n.jsxs("li",{className:`flex items-center gap-3 px-4 py-3 cursor-pointer 
                ${t?.friendName===a.name?"bg-blue-900":"bg-[#1d232a] hover:bg-[#20262d]"}`,onClick:()=>i(a._id,a.name,a.profileImage),children:[n.jsx("img",{src:a?.profileImage,alt:"profile",className:"w-10 h-10 rounded-full"}),n.jsxs("div",{className:"flex-1",children:[n.jsx("p",{className:"font-medium text-sm",children:a.name}),n.jsx("span",{className:"text-xs text-green-400",children:"online"})]}),n.jsx("time",{className:"text-xs text-gray-400",children:a.time})]},o))})})]}),t&&n.jsx(R,{chatId:t.chatId,friendName:t.friendName,userId:r,friendImage:t.friendImage})]})},T=()=>{const[e,r]=d.useState([]),[t,s]=d.useContext(C);return d.useEffect(()=>{const i=a=>{const o=a.filter(u=>u._id!==String(t));console.log(o),r(o)};return m.connect(),m.on("online_users",i),console.log("render one time "),()=>{m.off("online_users",i)}},[t]),n.jsx(n.Fragment,{children:n.jsx("div",{className:"flex min-h-screen bg-[#0d1117] text-white",children:n.jsx(B,{friends:e,userId:String(t)})})})};export{T as default};
